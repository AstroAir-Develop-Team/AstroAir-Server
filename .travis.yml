language: cpp
sudo: required
os:
  - linux
dist: focal
compiler:
  - clang
branches:
  only:
  - master

before_install:
  - sudo apt update && sudo apt upgrade
  - echo "Update and Upgrade\n"
  - git clone https://github.com/open-source-parsers/jsoncpp
  - cd jsoncpp
  - mkdir build && cd build
  - cmake -DCMAKE_INSTALL_PREFIX=/usr ..
  - make -j4
  - cd ../..
  - echo "Build newest Jsoncpp library"

before_script:
  - echo "Prepare to run the script"
after_script:
  - echo "Finish running script"

script:
  - sudo mv /usr/include/opencv4/opencv2 /usr/include
  - echo "Start Building..."
  - mkdir build && cd build
  - cmake ..
  - make -j4
  - cmake clean
  - echo "Finish Building..."

after_success:
  - echo "Building successfully without error!"
after_failure:
  - echo "Unable to build!"

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - sourceline: 'ppa:mutlaqja/ppa'
      - sourceline: 'ppa:pch/phd2'
    packages:
      - make
      - cmake
      - indi-full
      - phd2
      - clang-11
      - libwebsocketpp-dev
      - libasio-dev
      - libopencv-dev
      - libcfitsio-dev
      - libccfits-dev
      - libssl-dev
      - libnova-dev
      - libgphoto2-dev

  hosts:
    - ci.astroair.cn

notifications:
  email: false